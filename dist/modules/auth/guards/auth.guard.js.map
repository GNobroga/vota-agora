{"version":3,"sources":["../../../../src/modules/auth/guards/auth.guard.ts"],"sourcesContent":["import { CanActivate, ExecutionContext, Injectable } from \"@nestjs/common\";\r\nimport { JwtService } from \"@nestjs/jwt\";\r\nimport { Request } from \"express\";\r\n\r\n@Injectable()\r\nexport default class AuthGuard implements CanActivate {\r\n\r\n    constructor(private readonly _jwtService: JwtService) {}\r\n\r\n    async canActivate(context: ExecutionContext): Promise<boolean> {\r\n        const http = context.switchToHttp();\r\n        const request = http.getRequest<Request>();\r\n\r\n        const token = this.extractTokenFromHeader(request);\r\n        if (!token) {\r\n          return false;\r\n        }\r\n\r\n        try {\r\n            const payload = await this._jwtService.verifyAsync(token);\r\n            request['user'] = payload;\r\n            return true;\r\n        } catch {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    private extractTokenFromHeader(request: Request): string | undefined {\r\n        const [type, token] = request.headers.authorization?.split(' ') ?? [];\r\n        return type === 'Bearer' ? token : undefined;\r\n    }\r\n\r\n}"],"names":["AuthGuard","canActivate","context","http","switchToHttp","request","getRequest","token","extractTokenFromHeader","payload","_jwtService","verifyAsync","type","headers","authorization","split","undefined","constructor"],"mappings":";;;;;;;eAKqBA;;;wBALqC;qBAC/B;;;;;;;;;;AAIZ,IAAA,AAAMA,YAAN,MAAMA;IAIjB,MAAMC,YAAYC,OAAyB,EAAoB;QAC3D,MAAMC,OAAOD,QAAQE,YAAY;QACjC,MAAMC,UAAUF,KAAKG,UAAU;QAE/B,MAAMC,QAAQ,IAAI,CAACC,sBAAsB,CAACH;QAC1C,IAAI,CAACE,OAAO;YACV,OAAO;QACT;QAEA,IAAI;YACA,MAAME,UAAU,MAAM,IAAI,CAACC,WAAW,CAACC,WAAW,CAACJ;YACnDF,OAAO,CAAC,OAAO,GAAGI;YAClB,OAAO;QACX,EAAE,OAAM;YACJ,OAAO;QACX;IACJ;IAEQD,uBAAuBH,OAAgB,EAAsB;QACjE,MAAM,CAACO,MAAML,MAAM,GAAGF,QAAQQ,OAAO,CAACC,aAAa,EAAEC,MAAM,QAAQ,EAAE;QACrE,OAAOH,SAAS,WAAWL,QAAQS;IACvC;IAvBAC,YAAY,AAAiBP,WAAuB,CAAE;aAAzBA,cAAAA;IAA0B;AAyB3D"}