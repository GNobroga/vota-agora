{"version":3,"sources":["../../../src/modules/auth/auth.service.ts"],"sourcesContent":["import { Inject, Injectable, UnauthorizedException } from \"@nestjs/common\";\r\nimport { IUserRepository, USER_REPOSITORY_TOKEN } from \"../users/interfaces/user-repository.interface\";\r\nimport { JwtService } from \"@nestjs/jwt\";\r\nimport LoginRequestDTO from \"./dtos/request/login-request.dto\";\r\nimport * as bcrypt from 'bcrypt';\r\n\r\n@Injectable()\r\nexport default class AuthService {\r\n    constructor(\r\n        @Inject(USER_REPOSITORY_TOKEN)\r\n        private readonly _userRepository: IUserRepository,\r\n        private jwtService: JwtService\r\n    ) {}\r\n\r\n    async signIn(request: LoginRequestDTO) {\r\n        const user = await this._userRepository.findByDocument(request.document);\r\n\r\n        if (!user) {\r\n            throw new UnauthorizedException('Usu치rio ou senha inv치lidos.');\r\n        }\r\n\r\n        const isPasswordValid = await bcrypt.compare(request.password, user.password);\r\n\r\n        if (!isPasswordValid) {\r\n            throw new UnauthorizedException('Usu치rio ou senha inv치lidos.');\r\n        }\r\n\r\n        const payload = { \r\n            sub: user['_id'],\r\n            document: user.document, \r\n            walletAddress: user.accountAddress, \r\n            role: user.role \r\n        };\r\n\r\n        return {\r\n            access_token: await this.jwtService.signAsync(payload),\r\n        }\r\n    }\r\n}\r\n"],"names":["AuthService","signIn","request","user","_userRepository","findByDocument","document","UnauthorizedException","isPasswordValid","bcrypt","compare","password","payload","sub","walletAddress","accountAddress","role","access_token","jwtService","signAsync","constructor"],"mappings":";;;;;;;eAOqBA;;;wBAPqC;yCACH;qBAC5B;gEAEH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGT,IAAA,AAAMA,cAAN,MAAMA;IAOjB,MAAMC,OAAOC,OAAwB,EAAE;QACnC,MAAMC,OAAO,MAAM,IAAI,CAACC,eAAe,CAACC,cAAc,CAACH,QAAQI,QAAQ;QAEvE,IAAI,CAACH,MAAM;YACP,MAAM,IAAII,6BAAqB,CAAC;QACpC;QAEA,MAAMC,kBAAkB,MAAMC,QAAOC,OAAO,CAACR,QAAQS,QAAQ,EAAER,KAAKQ,QAAQ;QAE5E,IAAI,CAACH,iBAAiB;YAClB,MAAM,IAAID,6BAAqB,CAAC;QACpC;QAEA,MAAMK,UAAU;YACZC,KAAKV,IAAI,CAAC,MAAM;YAChBG,UAAUH,KAAKG,QAAQ;YACvBQ,eAAeX,KAAKY,cAAc;YAClCC,MAAMb,KAAKa,IAAI;QACnB;QAEA,OAAO;YACHC,cAAc,MAAM,IAAI,CAACC,UAAU,CAACC,SAAS,CAACP;QAClD;IACJ;IA7BAQ,YACI,AACiBhB,eAAgC,EACjD,AAAQc,UAAsB,CAChC;aAFmBd,kBAAAA;aACTc,aAAAA;IACT;AA0BP"}