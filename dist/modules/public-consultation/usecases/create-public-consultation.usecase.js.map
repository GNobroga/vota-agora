{"version":3,"sources":["../../../../src/modules/public-consultation/usecases/create-public-consultation.usecase.ts"],"sourcesContent":["import { BadRequestException, Inject, Injectable } from \"@nestjs/common\";\r\nimport IUnaryUseCase from \"src/core/usecases/unary.usecase\";\r\nimport CreatePublicConsultationRequestDTO from \"../dtos/request/create-public-consultation-request.dto\";\r\nimport { IPublicConsultationRepository, PUBLIC_CONSULTATION_REPOSITORY_TOKEN } from \"../interfaces/public-consultation-repository.interface\";\r\nimport moment from \"moment\";\r\nimport PublicConsultation from \"../public-consultation.schema\";\r\n\r\n@Injectable()\r\nexport default class CreatePublicConsultationUseCase implements IUnaryUseCase<CreatePublicConsultationRequestDTO> {\r\n    \r\n    constructor(\r\n        @Inject(PUBLIC_CONSULTATION_REPOSITORY_TOKEN)\r\n        private readonly _publicConsultationRepository: IPublicConsultationRepository\r\n    ) {}\r\n    \r\n    async execute(input: CreatePublicConsultationRequestDTO) {\r\n        const today = moment().startOf('day');\r\n        const initialDate = moment(input.initialDate).startOf('day');\r\n        const endDate = moment(input.endDate).startOf('day');\r\n\r\n        if (initialDate.isBefore(today)) {\r\n            throw new BadRequestException('A data inicial não pode ser inferior à data atual.');\r\n        }\r\n\r\n        if (initialDate.isAfter(endDate)) {\r\n            throw new BadRequestException('A data inicial não pode ser superior à data final.');\r\n        }\r\n\r\n        await this._publicConsultationRepository.save(PublicConsultation.create(\r\n            input.title,\r\n            input.description,\r\n            input.initialDate,\r\n            input.endDate,\r\n        ));\r\n    }\r\n\r\n\r\n}"],"names":["CreatePublicConsultationUseCase","execute","input","today","moment","startOf","initialDate","endDate","isBefore","BadRequestException","isAfter","_publicConsultationRepository","save","PublicConsultation","create","title","description","constructor"],"mappings":";;;;;;;eAQqBA;;;wBARmC;uDAG4B;+DACjE;iFACY;;;;;;;;;;;;;;;;;;;;AAGhB,IAAA,AAAMA,kCAAN,MAAMA;IAOjB,MAAMC,QAAQC,KAAyC,EAAE;QACrD,MAAMC,QAAQC,IAAAA,eAAM,IAAGC,OAAO,CAAC;QAC/B,MAAMC,cAAcF,IAAAA,eAAM,EAACF,MAAMI,WAAW,EAAED,OAAO,CAAC;QACtD,MAAME,UAAUH,IAAAA,eAAM,EAACF,MAAMK,OAAO,EAAEF,OAAO,CAAC;QAE9C,IAAIC,YAAYE,QAAQ,CAACL,QAAQ;YAC7B,MAAM,IAAIM,2BAAmB,CAAC;QAClC;QAEA,IAAIH,YAAYI,OAAO,CAACH,UAAU;YAC9B,MAAM,IAAIE,2BAAmB,CAAC;QAClC;QAEA,MAAM,IAAI,CAACE,6BAA6B,CAACC,IAAI,CAACC,iCAAkB,CAACC,MAAM,CACnEZ,MAAMa,KAAK,EACXb,MAAMc,WAAW,EACjBd,MAAMI,WAAW,EACjBJ,MAAMK,OAAO;IAErB;IAxBAU,YACI,AACiBN,6BAA4D,CAC/E;aADmBA,gCAAAA;IAClB;AAwBP"}