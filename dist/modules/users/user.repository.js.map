{"version":3,"sources":["../../../src/modules/users/user.repository.ts"],"sourcesContent":["import { Injectable } from \"@nestjs/common\";\r\nimport { InjectModel } from \"@nestjs/mongoose\";\r\nimport { Model } from \"mongoose\";\r\nimport { User } from \"./user.schema\";\r\nimport Paginator from \"src/core/models/Paginator\";\r\n\r\nexport const USER_REPOSITORY_TOKEN = 'IUserRepository';\r\n\r\nexport interface IUserRepository {\r\n    create(record: User): Promise<User>;\r\n    findByDocument(document: string): Promise<User | null>;\r\n    findAll(paginator: Paginator): Promise<User[]>;\r\n}\r\n\r\n@Injectable()\r\nexport default class UserRepository implements IUserRepository {\r\n\r\n    constructor(\r\n        @InjectModel(User.name) private _userModel: Model<User>\r\n    ) {}\r\n\r\n    async findAll(paginator: Paginator): Promise<User[]> {\r\n        const skip = (paginator.page - 1) * paginator.size; \r\n        const users = await this._userModel.find()\r\n            .sort({ '_id': paginator.sort === 'desc' ? -1 : 1 })\r\n            .skip(skip)\r\n            .limit(paginator.size); \r\n        return users.map(doc => doc.toObject());\r\n    }\r\n\r\n    async findByDocument(document: string): Promise<User | null> {\r\n       try {\r\n            const result = await this._userModel.findOne({ document });\r\n            return result.toObject();\r\n       } catch(error) {\r\n            return null;\r\n       }\r\n    }\r\n\r\n    async create(record: User): Promise<User> {\r\n       const createdUser = await this._userModel.create(record);\r\n        return await createdUser.save();\r\n    }\r\n\r\n}"],"names":["USER_REPOSITORY_TOKEN","UserRepository","findAll","paginator","skip","page","size","users","_userModel","find","sort","limit","map","doc","toObject","findByDocument","document","result","findOne","error","create","record","createdUser","save","constructor","name"],"mappings":";;;;;;;;;;;IAMaA,qBAAqB;eAArBA;;;eASQC;;;wBAfM;0BACC;2BACN;4BACD;;;;;;;;;;;;;;;AAGd,MAAMD,wBAAwB;AAStB,IAAA,AAAMC,iBAAN,MAAMA;IAMjB,MAAMC,QAAQC,SAAoB,EAAmB;QACjD,MAAMC,OAAO,AAACD,CAAAA,UAAUE,IAAI,GAAG,CAAA,IAAKF,UAAUG,IAAI;QAClD,MAAMC,QAAQ,MAAM,IAAI,CAACC,UAAU,CAACC,IAAI,GACnCC,IAAI,CAAC;YAAE,OAAOP,UAAUO,IAAI,KAAK,SAAS,CAAC,IAAI;QAAE,GACjDN,IAAI,CAACA,MACLO,KAAK,CAACR,UAAUG,IAAI;QACzB,OAAOC,MAAMK,GAAG,CAACC,CAAAA,MAAOA,IAAIC,QAAQ;IACxC;IAEA,MAAMC,eAAeC,QAAgB,EAAwB;QAC1D,IAAI;YACC,MAAMC,SAAS,MAAM,IAAI,CAACT,UAAU,CAACU,OAAO,CAAC;gBAAEF;YAAS;YACxD,OAAOC,OAAOH,QAAQ;QAC3B,EAAE,OAAMK,OAAO;YACV,OAAO;QACZ;IACH;IAEA,MAAMC,OAAOC,MAAY,EAAiB;QACvC,MAAMC,cAAc,MAAM,IAAI,CAACd,UAAU,CAACY,MAAM,CAACC;QAChD,OAAO,MAAMC,YAAYC,IAAI;IACjC;IAzBAC,YACI,AAAgChB,UAAuB,CACzD;aADkCA,aAAAA;IACjC;AAyBP;;;6DA1B0BiB"}